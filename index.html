<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="./style.css">
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
  </head>
  <body>
    <script>

      $(document).ready(function(){
        var $body = $('body');
        $body.html('');

        // Helper function to format date
        var formatDateTime = function(date) {
            var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            var hours = (date.getHours() > 12) ? date.getHours() - 12 : date.getHours();
            var minutes = date.getMinutes().toString();
            while (minutes.length < 2) {
                minutes = '0' + minutes;
            }
            return months[date.getMonth()] + ' ' + date.getDate() + ' - ' + hours + ':' + date.getMinutes(); // TODO: sub minutes for date.getMinutes()
        };

        // Helper function to make new tweets
        var makeTweet = function(theTweet) {
            var output = $('<div></div>');
            output.html('<p><span class="heavy">' + theTweet.user + '</span> <span class="subtle">@' + theTweet.user + ' | ' + formatDateTime(theTweet.created_at) + '</span><br>' + theTweet.message + '</p>');
            return output;
        };

        var streamLength = streams.home.length;
        var index = streamLength - 1;
        var tweet;
        var $tweet;
        while(index >= 0){
          tweet = streams.home[index];
          $tweet = makeTweet(tweet);
          $tweet.appendTo($body);
          index -= 1;
        }

        // Add new tweets as they are created
        setInterval(function() {
            if (streams.home.length > streamLength) {
                for (var i = streamLength; i < streams.home.length; i++) {
                    tweet = streams.home[i];
                    $tweet = makeTweet(tweet);
                    $tweet.prependTo($body);
                }
                streamLength = streams.home.length;
            }
        }, 100);

      });

    </script>
  </body>
</html>
